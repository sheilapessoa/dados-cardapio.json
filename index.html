<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>Meu Menu Digital</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">


  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    /* ===== Estilo Base ===== */
    body { font-family: 'Roboto', sans-serif; margin: 0; padding: 20px; background-color: #f9f9f9; padding-bottom: 100px; }
    h1 { text-align: center; color: #333; display: flex; flex-direction: column; align-items: center; gap: 10px; margin-top: 20px; }
    .logo { height: 70px; width: auto; border-radius: 12px; }
    .container { max-width: 800px; margin: auto; }
    
    /* ===== Splash Screen ===== */
    #loading-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-color: #ffffff; display: flex; flex-direction: column;
      align-items: center; justify-content: center; z-index: 9999;
      transition: opacity 0.5s ease;}
    .loader-logo { width: 90px; height: auto; margin-bottom: 20px; animation: pulse 1.5s infinite; border-radius: 10px; }
    .progress-container { 
  width: 150px; height: 4px; background-color: #eee; 
  border-radius: 10px; overflow: hidden; 
}
    .progress-bar { 
  width: 0%; /* Come√ßa em zero */
  height: 100%; 
  background-color: #ccc; /* Cinza apenas por milissegundos */
  transition: width 0.6s ease, background-color 0.3s ease; 
}
    @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.05); opacity: 1; } }
    @keyframes loadAnim { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

   /* ===== Notifica√ß√µes na Parte Superior ===== */
#toast-container { 
  position: fixed; 
  top: 70px;            /* Fica abaixo da barra de status que colocamos no topo */
  left: 50%; 
  transform: translateX(-50%); 
  z-index: 10000; 
  display: flex; 
  flex-direction: column; 
  gap: 10px; 
  pointer-events: none; 
}

.toast { 
  background: #333; 
  color: white; 
  padding: 10px 20px; 
  border-radius: 50px; 
  font-size: 0.85em; 
  box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
  animation: slideDown 0.3s forwards; /* Mudamos o nome da anima√ß√£o */
}

/* Nova anima√ß√£o vindo de cima */
@keyframes slideDown { 
  from { 
    transform: translateY(-50px); /* Come√ßa acima da tela */
    opacity: 0; 
  } 
  to { 
    transform: translateY(0); 
    opacity: 1; 
  } 
}
    /* ===== Categorias e Itens ===== */
    .section-title { font-size: 1.1em; font-weight: bold; color: #388e3c; margin: 25px 0 12px; padding-left: 8px; border-left: 4px solid; text-transform: uppercase; }
    .menu-item { background: #fff; border-radius: 15px; padding: 15px; margin-bottom: 12px; display: flex; align-items: flex-start; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .item-image { width: 80px; height: 80px; object-fit: cover; border-radius: 12px; margin-right: 15px; flex-shrink: 0; }
    .item-details { flex-grow: 1; position: relative; }
    .item-header-clickable { display: flex; justify-content: space-between; align-items: center; width: 100%; cursor: pointer; }
    .item-name { font-weight: bold; font-size: 1em; color: #333; }
    .toggle-icon { font-size: 0.9em; transition: transform 0.3s ease; color: #bbb; }
    .item-description { color: #777; font-size: 0.85em; margin: 4px 0 8px; line-height: 1.3; padding-right: 10px; }
    .item-price { font-weight: bold; color: #000; font-size: 1.05em; }

    /* Op√ß√µes e Bot√£o Adicionar (Ajustado) */
    .options-and-footer-container { display: none; margin-top: 15px; padding-top: 10px; border-top: 1px dashed #eee; }
    .footer-action { display: flex; justify-content: flex-end; width: 100%; margin-top: 10px; }
    
    .add-to-cart-btn { 
      background-color: #388e3c; color: white; padding: 8px 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.9em;transition: opacity 0.2s;}
    .add-to-cart-btn:active { opacity: 0.7; }

    .option-group h4 { margin: 10px 0 5px; font-size: 0.9em; color: #666; background: #f5f5f5; padding: 4px 10px; border-radius: 4px; }
    .option-list-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-size: 0.9em; }
    .quantity-controls { display: flex; align-items: center; gap: 8px; }
    .quantity-controls button { border: none; color: white; width: 24px; height: 24px; border-radius: 6px; cursor: pointer; font-weight: bold; }
    .quantity-controls input { width: 25px; text-align: center; border: none; background: transparent; font-weight: bold; font-size: 0.95em; }

   /* ===== Carrinho flutuante (Lado Direito) ===== */
    #cart-float {
  position: fixed;
  top: 20px;
  right: 20px;
  bottom: auto;
  background: ;
  color: white;
  padding: 10px 15px;
  border-radius: 50px;
  cursor: pointer;
  font-size: 1.2em;
  z-index: 1000;
  display: flex;
  align-items: center;
  gap: 8px;
}
.search-container { max-width: 800px; margin: 0 auto 15px; display: flex; align-items: center; gap: 10px; padding: 10px 18px; background: #fff; border-radius: 50px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #eee; position: sticky; top: 10px; z-index: 900; }
    #search-input { border: none; outline: none; background: transparent; width: 100%; font-size: 0.95em; }

    #cart-modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); }
    .cart-modal-content {
  background: #fff;
  padding: 20px;
  width: 85%;
  max-width: 380px;
  border-radius: 15px;
}

/* üî• MOBILE: modal estilo app */
@media (max-width: 600px) {
  .cart-modal-content {
    width: 100%;
    max-width: 100%;
    height: 85vh;
    margin: 0;
    border-radius: 20px 20px 0 0;
    position: absolute;
    bottom: 0;
    left: 0;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(100%); }
    to   { transform: translateY(0); }
  }
}
/* ===== MODAL ESTILO IFOOD ===== */
@media (max-width: 600px) {

  body.modal-open {
    overflow: hidden;
    touch-action: none;
  }

  .cart-modal-content {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    max-width: 100%;
    height: 90vh;
    margin: 0;
    padding: 0;
    border-radius: 18px 18px 0 0;
    display: flex;
    flex-direction: column;
    animation: slideUp 0.25s ease;
  }

  /* Cabe√ßalho fixo */
  .cart-header {
    padding: 16px;
    font-weight: bold;
    font-size: 1em;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #fff;
  }

  /* Conte√∫do com scroll */
  .cart-body {
    flex: 1;
    overflow-y: auto;
    padding: 12px 16px;
  }

  /* Rodap√© fixo */
  .cart-footer {
    padding: 14px 16px;
    border-top: 1px solid #eee;
    background: #fff;
  }

  .cart-footer button {
    width: 100%;
    padding: 14px;
    font-size: 1em;
    border-radius: 10px;
  }

  /* Handle de arrastar */
  .drag-handle {
    width: 40px;
    height: 4px;
    background: #ccc;
    border-radius: 10px;
    margin: 8px auto;
  }

  @keyframes slideUp {
    from { transform: translateY(100%); }
    to   { transform: translateY(0); }
  }
}


/* ===== MOBILE FIRST ===== */
@media (max-width: 600px) {

  body {
    padding: 12px;
    padding-bottom: 120px;
  }

  h1 {
    font-size: 1.2em;
    margin-top: 10px;
  }

  .logo {
    height: 55px;
  }

  .container {
    max-width: 100%;
  }

  .menu-item {
    padding: 12px;
    gap: 10px;
  }

  .item-image {
    width: 65px;
    height: 65px;
    margin-right: 10px;
  }

  .item-name {
    font-size: 0.95em;
  }

  .item-description {
    font-size: 0.8em;
  }

  .item-price {
    font-size: 1em;
  }

  .add-to-cart-btn {
    padding: 10px 14px;
    font-size: 0.85em;
  }

  /* üî• Carrinho flutuante no polegar */
  #cart-float {
    top: auto;
    bottom: 20px;
    right: 20px;
    padding: 12px 16px;
    font-size: 1.1em;
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  }

  /* üî• Modal estilo app */
  .cart-modal-content {
    width: 100%;
    max-width: 100%;
    height: 85vh;
    margin: 0;
    border-radius: 20px 20px 0 0;
    position: absolute;
    bottom: 0;
    left: 0;
    padding-bottom: 20px;
    animation: slideUp 0.3s ease;
  }

  #cart-items {
    max-height: 40vh;
    overflow-y: auto;
  }

  @keyframes slideUp {
    from {
      transform: translateY(100%);
    }
    to {
      transform: translateY(0);
    }
  }

  /* üîç Busca fixa confort√°vel */
  .search-container {
    position: sticky;
    top: 8px;
    padding: 10px 14px;
    z-index: 900;
  }
}
/* ===== DESKTOP: Carrinho estilo painel lateral ===== */
@media (min-width: 601px) {

  #cart-modal {
    display: none;
    justify-content: flex-end;
    align-items: stretch;
  }

  #cart-modal[style*="block"] {
    display: flex !important;
  }

  .cart-modal-content {
    position: relative;
    width: 420px;
    max-width: 420px;
    height: 100vh;
    border-radius: 0;
    animation: slideLeft 0.25s ease;
    display: flex;
    flex-direction: column;
  }

  /* Remove o handle no desktop */
  .drag-handle {
    display: none;
  }

  @keyframes slideLeft {
    from { transform: translateX(100%); }
    to   { transform: translateX(0); }
  }
}
@media (min-width: 601px) {

  .cart-header {
    position: relative;
  }

  #close-cart {
    position: absolute;
    top: 16px;
    right: 16px;
    font-size: 1.6em;
    cursor: pointer;
  }
}
/* ===== DESKTOP: Bot√£o fechar fora do header ===== */
@media (min-width: 601px) {

  #close-cart {
    position: fixed;
    top: 20px;
    right: 20px;
    font-size: 1.8em;
    color: #555;
    cursor: pointer;
    z-index: 1100;
    background: #fff;
    width: 38px;
    height: 38px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    transition: transform 0.2s ease, opacity 0.2s ease;
  }

  #close-cart:hover {
    transform: scale(1.1);
    opacity: 0.7;
  }
}

</style>
</head>
<body>

  <div id="loading-overlay">
    <img id="loader-logo-img" class="loader-logo" src="" style="display:none;">
    <div class="progress-container"><div class="progress-bar" id="main-progress-bar"></div></div>
    <p style="margin-top:10px; color:#888; font-size: 0.8em;">Carregando...</p>
  </div>
  <div id="toast-container"></div>

  <h1>
    <img id="company-logo" class="logo" style="display: none;" alt="Logo">
    <span id="company-name"></span>
  </h1>

  <div id="status-message" style="text-align: center; font-weight: bold; margin-bottom: 10px; font-size: 0.9em;"></div>

  <div class="search-container">
    <i class="fas fa-search" style="color: #ccc;"></i>
    <input type="text" id="search-input" placeholder="Buscar no card√°pio...">
  </div>

  <div class="container">
    <div id="menu-content"></div>
  </div>

 <div id="cart-float">
  <i class="fas fa-shopping-cart"></i>
  <span></span>
  <span id="cart-count">0</span>
</div>
<div id="cart-modal">
  <div class="cart-modal-content">

    <div class="drag-handle"></div>

    <div class="cart-header">
      <span>Meu Pedido</span>
      <span id="close-cart" style="cursor:pointer;font-size:1.3em;">&times;</span>
    </div>

    <div class="cart-body">
      <label style="font-weight:bold;font-size:0.9em;">Seu Nome</label>
      <input id="client-name" type="text" placeholder="Digite seu nome"
        style="width:100%;margin:8px 0 15px;padding:12px;border:1px solid #ddd;border-radius:8px">

      <div id="cart-items"></div>
    </div>

    <div class="cart-footer">
      <div style="display:flex;justify-content:space-between;font-weight:bold;margin-bottom:10px;">
        <span>Total</span>
        <span>R$ <span id="cart-total">0,00</span></span>
      </div>
      <button class="add-to-cart-btn" onclick="finalizarPedido()">
        Finalizar no WhatsApp
      </button>
    </div>

  </div>
</div>


  <script>
    let cart = [];
    let companyWhatsApp = '';
    let themeColor = "#388e3c";
    let companyStatus = "Aberto";

    function notify(msg) {
      const container = document.getElementById('toast-container');
      const t = document.createElement('div');
      t.className = 'toast';
      t.textContent = msg;
      container.appendChild(t);
      setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 500); }, 2000);
    }

document.addEventListener('DOMContentLoaded', async () => {
  const progressBar = document.getElementById('main-progress-bar');
  if (progressBar) progressBar.style.width = '15%';

  try {
    // üöÄ AJUSTE DE CAMINHO: Aponta para a pasta que vimos na sua foto
   const response = await fetch('./dados/cardapio.json?v=' + Date.now());
    
    if (!response.ok) throw new Error('Arquivo n√£o encontrado no servidor');
    
    const res = await response.json();

    if (res.success) {
      const info = res.info;
      const data = res.menu;

      // Configura√ß√µes visuais (Cores e WhatsApp)
      themeColor = info.siteColor || "#388e3c";
      companyWhatsApp = info.whatsappNumber || '';
      companyStatus = info.status || 'Aberto';
      
      document.getElementById('company-name').textContent = info.companyName;
      if (info.logoUrl) {
        document.getElementById('company-logo').src = info.logoUrl;
        document.getElementById('company-logo').style.display = 'block';
        if (document.getElementById('loader-logo-img')) {
          document.getElementById('loader-logo-img').src = info.logoUrl;
          document.getElementById('loader-logo-img').style.display = 'block';
        }
      }

      // Aplica o tema din√¢mico
      const style = document.createElement('style');
      style.textContent = `
        .section-title { border-color: ${themeColor}; color: ${themeColor}; }
        .add-to-cart-btn, #cart-float, .quantity-controls button { background-color: ${themeColor} !important; }
        .item-name { color: ${themeColor}; }
      `;
      document.head.appendChild(style);
      
      if (progressBar) {
        progressBar.style.backgroundColor = themeColor;
        progressBar.style.width = '100%';
      }

      renderMenu(data);

      setTimeout(() => {
        const overlay = document.getElementById('loading-overlay');
        if (overlay) {
          overlay.style.opacity = '0';
          setTimeout(() => overlay.style.display = 'none', 500);
        }
      }, 600);

    } else {
      notify("Erro: Os dados do card√°pio est√£o incompletos.");
    }
  } catch (err) {
    console.error("Erro t√©cnico:", err);
    notify("Sem conex√£o com o card√°pio. Clique em 'Publicar' no Admin.");
  }

  setupUI();
});

    function renderMenu(data) {
      const content = document.getElementById('menu-content');
      content.innerHTML = '';
      let items = [
        ...(data.optionsItems || []).map(i => ({...i, type:'complex'})),
        ...(data.menuItems || []).map(i => ({...i, type:'simple'}))
      ];
      let cats = {};
      items.forEach(i => {
        const c = i.Categoria || 'Outros';
        if (!cats[c]) cats[c] = [];
        cats[c].push(i);
      });
      Object.keys(cats).sort().forEach(cat => {
        const title = document.createElement('div');
        title.className = 'section-title';
        title.textContent = cat;
        content.appendChild(title);
        cats[cat].forEach(item => renderItem(item));
      });
      document.getElementById('loading-overlay').style.opacity = '0';
      setTimeout(() => document.getElementById('loading-overlay').style.display = 'none', 500);
    }

    function renderItem(item) {
      const content = document.getElementById('menu-content');
      const div = document.createElement('div');
      div.className = 'menu-item';
      const img = item['Imagem'] || item['URL da Imagem'];
      
      div.innerHTML = `
        ${img ? `<img src="${img}" class="item-image" loading="lazy">` : ''}
        <div class="item-details">
          <div class="item-header-clickable" onclick="toggle(this, ${item.type === 'complex'})">
            <span class="item-name">${item.Nome}</span>
            ${item.type === 'complex' ? '<i class="fas fa-chevron-down toggle-icon"></i>' : ''}
          </div>
          <div class="item-description">${item.Descri√ß√£o || ''}</div>
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span class="item-price">R$ ${parseFloat(item.Valor).toFixed(2).replace('.', ',')}</span>
            ${item.type === 'simple' ? `<button class="add-to-cart-btn" onclick="add(this, '${item.Nome}', ${item.Valor}, false)">Adicionar</button>` : ''}
          </div>
          <div class="options-and-footer-container">
            ${item.type === 'complex' ? renderOptions(item) : ''}
            <div class="footer-action">
              <button class="add-to-cart-btn" onclick="add(this, '${item.Nome}', ${item.Valor}, true)">Adicionar</button>
            </div>
          </div>
        </div>
      `;
      content.appendChild(div);
    }

    function renderOptions(item) {
      let h = '';
      for (let k in item) {
        if (item[k]?.items) {
          h += `<div class="option-group">
            <h4>${k} (At√© ${item[k].limit})</h4>
            ${item[k].items.map(o => `
              <div class="option-list-item">
                <span>${o}</span>
                <div class="quantity-controls">
                  <button onclick="qty(this,-1)">-</button>
                  <input type="number" value="0" data-opt="${o}" data-limit="${item[k].limit}" readonly>
                  <button onclick="qty(this,1)">+</button>
                </div>
              </div>
            `).join('')}
          </div>`;
        }
      }
      return h;
    }

    function toggle(el, isComplex) {
      if(!isComplex) return;
      const box = el.parentElement.querySelector('.options-and-footer-container');
      const icon = el.querySelector('.toggle-icon');
      const open = box.style.display === 'block';
      box.style.display = open ? 'none' : 'block';
      icon.style.transform = open ? 'rotate(180deg)' : 'rotate(0deg)';
    }

    function qty(btn, d) {
      const i = btn.parentElement.querySelector('input');
      const group = i.closest('.option-group').querySelectorAll('input');
      let t = 0; group.forEach(g => t += parseInt(g.value));
      let cur = parseInt(i.value);
      if(d > 0 && t < i.dataset.limit) i.value = cur + 1;
      else if(d < 0 && cur > 0) i.value = cur - 1;
      else if(d > 0) notify("Limite atingido!");
    }

    function add(btn, name, price, isComplex) {
      if(companyStatus !== 'Aberto') return notify("Loja Fechada!");
      let opts = [];
      if(isComplex) {
        btn.closest('.options-and-footer-container').querySelectorAll('input').forEach(i => {
          if(parseInt(i.value) > 0) opts.push({name: i.dataset.opt, qty: i.value});
        });
        if(!opts.length) return notify("Escolha uma op√ß√£o!");
        btn.closest('.options-and-footer-container').querySelectorAll('input').forEach(i => i.value = 0);
        toggle(btn.closest('.item-details').querySelector('.item-header-clickable'), true);
      }
      const key = name + JSON.stringify(opts);
      const ex = cart.find(c => c.key === key);
      if(ex) ex.qty++; else cart.push({key, name, price, opts, qty: 1});
      updateUI();
      notify("Adicionado!");
    }

    function updateUI() {
      const list = document.getElementById('cart-items');
      let t = 0, c = 0; list.innerHTML = '';
      cart.forEach((item, idx) => {
        t += item.price * item.qty; c += item.qty;
        list.innerHTML += `<div style="padding:10px 0; border-bottom:1px solid #eee; font-size: 0.9em;">
          <b>${item.qty}x ${item.name}</b> <span style="float:right">R$ ${(item.price*item.qty).toFixed(2)}</span>
          <div style="font-size:0.85em; color:#888">${item.opts.map(o => o.qty+'x '+o.name).join(', ')}</div>
          <button onclick="remove(${idx})" style="color:red; border:none; background:none; cursor:pointer; padding:0; font-size:0.85em">Remover</button>
        </div>`;
      });
      document.getElementById('cart-count').textContent = c;
      document.getElementById('cart-total').textContent = t.toFixed(2).replace('.', ',');
    }

    function remove(i) {
      if(cart[i].qty > 1) cart[i].qty--; else cart.splice(i,1);
      updateUI();
    }
function finalizarPedido() {
  const nomeCliente = document.getElementById('client-name').value.trim();
  
  // Valida√ß√µes
  if (companyStatus !== 'Aberto') return notify("Loja Fechada!");
  if (!cart.length) return notify("Sacola vazia!");
  if (!nomeCliente) return notify("Por favor, informe seu nome."); 

  let mensagem = 'Ol√°, gostaria de fazer o pedido:%0A';
  mensagem += `*Cliente:* ${nomeCliente}%0A`;
  let totalGeral = 0;

  cart.forEach(item => {
    const subTotal = item.price * item.qty;
    totalGeral += subTotal;

    // Item principal
    mensagem += `%0A${item.qty}x ${item.name} - R$ ${subTotal.toFixed(2).replace('.', ',')}%0A`;

    // Opcionais (um embaixo do outro)
    if (item.opts && item.opts.length > 0) {
      mensagem += item.opts.map(o => `‚Ä¢ ${o.qty}x ${o.name}`).join('%0A') + '%0A';
    }
  });

  // Total no final
  mensagem += `%0A*Total do Pedido: R$ ${totalGeral.toFixed(2).replace('.', ',')}*`;

  if (!companyWhatsApp) return notify("WhatsApp n√£o configurado!");

  window.open(`https://wa.me/${companyWhatsApp}?text=${mensagem}`, '_blank');

  // Limpa o carrinho e fecha o modal
  cart = [];
  document.getElementById('client-name').value = '';
  updateUI();
  document.getElementById('cart-modal').style.display = 'none';
  notify("Pedido enviado!");
}

  function setupUI() {
  const modal = document.getElementById('cart-modal');

  document.getElementById('cart-float').onclick = () => {
    modal.style.display = 'block';
    document.body.classList.add('modal-open');
  };

  document.getElementById('close-cart').onclick = () => {
    modal.style.display = 'none';
    document.body.classList.remove('modal-open');
  };

  document.getElementById('search-input').oninput = (e) => {
    const v = e.target.value.toLowerCase();
    document.querySelectorAll('.menu-item').forEach(i =>
      i.style.display = i.innerText.toLowerCase().includes(v) ? 'flex' : 'none'
    );
  };
}
  </script>
</body>
</html>
